<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <title>inzynierka</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>

<body>
    <p>Wynik jednostkowy: <span id="result"></span></p>
    <p>Wynik caly dla przegladarki: <span id="final_result"></span></p>
</body>

<script src="index.js"></script>
<script>
    function connect() {
        let localTotal = 0;
        const socket = io("http://localhost:8080/worker");
        socket.on("connect", () => {
            console.log("Połączono z Socket.IO");
        });

        socket.on("task", (data) => {
            const result = Module.ccall("add", "number", ["number", "number", "number"], [data.a, data.b, data.dx]);

            document.getElementById("result").textContent = result.toFixed(6);
            localTotal += result;
            document.getElementById("final_result").textContent = localTotal.toFixed(6);

            socket.emit("result", {
                taskId: data.taskId,
                result: result
            });
        });

        socket.on("disconnect", () => {
            console.log("❌ Rozłączono. Próba ponownego połączenia...");
            setTimeout(connect, 1000);
        });
    }

    Module.onRuntimeInitialized = () => {
        connect();
    };
</script>

</html>