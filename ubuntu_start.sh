#!/bin/bash

echo "ğŸŸ¡      Runs RabbitMQ      ğŸŸ¡"
sudo rabbitmq-server -detached

echo "ğŸŸ¡  Runs worker http 8000  ğŸŸ¡"
(cd worker && python3 -m http.server 8000) &
PID1=$!

trap cleanup INT

cleanup() {
    echo ""
    echo "ğŸ›‘           HTTP         ğŸ›‘"
    kill $PID1
    # kill $PID2

    echo "ğŸ›‘        RabbitMQ        ğŸ›‘"
    sudo rabbitmqctl purge_queue tasks
    sudo systemctl stop rabbitmq-server

    echo "ğŸŸ¢        ZamkniÄ™to       ğŸŸ¢"
    exit 0
}

echo "ğŸŸ¢        All good         ğŸŸ¢"
while true; do sleep 1; done
